# Архитектура и логика работы приложения

Этот документ описывает внутреннее устройство проекта, чтобы его можно было понять, воспроизвести и расширить.

## Общая схема работы

Проект разделен на три логических слоя: **интерфейс** (как пользователь взаимодействует), **ядро** (что делает программа) и **утилиты** (вспомогательные инструменты).

-   `Интерфейс (CLI или Bot)` → `Ядро (Transcriber, Spreadsheet)` → `Утилиты (Parser, Audio)`

## Компоненты и их расположение

-   **`main.py`** (в корне)
    Единственная точка входа. Не содержит логики, только читает аргумент (`cli` или `bot`) и передает управление нужному интерфейсу.

-   **`src/voice_tracker/interfaces/`**
    Папка для модулей, отвечающих за взаимодействие с пользователем.
    -   `cli.py`: Логика для работы в командной строке.
    -   `bot.py`: Логика для работы Telegram-бота.

-   **`src/voice_tracker/core/`**
    Содержит основную бизнес-логику.
    -   `transcriber.py`: Обертка для Whisper. Принимает аудио, отдает текст.
    -   `spreadsheet.py`: Отвечает за все операции с Excel-файлом, включая бэкапы.

-   **`src/voice_tracker/utils/`**
    Вспомогательные модули, которые используются другими частями программы.
    -   `audio.py`: Функции для записи звука с микрофона.
    -   `command_parser.py`: Анализирует распознанный текст и находит в нем ключевые категории.
    -   `config_loader.py`: Загружает и проверяет файл конфигурации `config.yaml`.

## Поток данных (CLI)

1.  `main.py cli` запускает `interfaces.cli.run()`.
2.  `cli.py` вызывает `utils.audio.record_audio()` для записи звука.
3.  Записанный файл передается в `core.transcriber.transcribe()`, который возвращает текст.
4.  Текст анализируется `utils.command_parser.parse_command()`.
5.  Найденные категории и баллы передаются в `core.spreadsheet.update_cell()` для записи в Excel.

## Поток данных (Telegram-бот)

1.  `main.py bot` запускает `interfaces.bot.run()`.
2.  `bot.py` запускает long-polling и ждет сообщений от Telegram.
3.  При получении голосового сообщения оно скачивается и передается в `core.transcriber.transcribe()`.
4.  Дальнейший поток аналогичен CLI: текст парсится, данные записываются в Excel.